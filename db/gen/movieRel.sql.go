// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: movieRel.sql

package db

import (
	"context"
)

const getActorsByMovie = `-- name: GetActorsByMovie :many
SELECT
  a.id,
  a.first_name,
  a.last_name,
  a.image_url
FROM actors a
JOIN movie_cast mc ON a.id = mc.actor_id
WHERE mc.movie_id = $1
`

func (q *Queries) GetActorsByMovie(ctx context.Context, movieID int32) ([]Actor, error) {
	rows, err := q.db.QueryContext(ctx, getActorsByMovie, movieID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Actor
	for rows.Next() {
		var i Actor
		if err := rows.Scan(
			&i.ID,
			&i.FirstName,
			&i.LastName,
			&i.ImageUrl,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getGenresByMovie = `-- name: GetGenresByMovie :many
SELECT
  g.id,
  g.name
FROM genres g
JOIN movie_genres mg ON g.id = mg.genre_id
WHERE mg.movie_id = $1
`

func (q *Queries) GetGenresByMovie(ctx context.Context, movieID int32) ([]Genre, error) {
	rows, err := q.db.QueryContext(ctx, getGenresByMovie, movieID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Genre
	for rows.Next() {
		var i Genre
		if err := rows.Scan(&i.ID, &i.Name); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getKeywordsByMovie = `-- name: GetKeywordsByMovie :many
SELECT
  k.word
FROM keywords k
JOIN movie_keywords mk ON k.id = mk.keyword_id
WHERE mk.movie_id = $1
`

func (q *Queries) GetKeywordsByMovie(ctx context.Context, movieID int32) ([]Keyword, error) {
	rows, err := q.db.QueryContext(ctx, getKeywordsByMovie, movieID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()

	var items []Keyword
	for rows.Next() {
		var k Keyword
		if err := rows.Scan(&k.ID, &k.Word); err != nil {
			return nil, err
		}
		items = append(items, k)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

func (q *Queries) FetchMoviesRelations(m *Movie) error {
	ctx := context.Background()

	genres, err := q.GetGenresByMovie(ctx, m.ID)
	if err != nil {
		return err
	}
	m.Genres = genres

	actors, err := q.GetActorsByMovie(ctx, m.ID)
	if err != nil {
		return err
	}
	m.Actors = actors

	keywords, err := q.GetKeywordsByMovie(ctx, m.ID)
	if err != nil {
		return err
	}
	m.Keywords = keywords

	return nil
}
